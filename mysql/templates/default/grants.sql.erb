# Generated by Chef for <%= node['hostname'] %>.
# Local modifications will be overwritten.

<% case node['platform'] -%>
<% when "debian","ubuntu" -%>
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, RELOAD, SHUTDOWN, PROCESS, FILE, REFERENCES, INDEX, ALTER, SHOW DATABASES, SUPER, CREATE TEMPORARY TABLES, LOCK TABLES, EXECUTE, REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO 'debian-sys-maint'@'localhost' IDENTIFIED BY '<%= node[:mysql][:server_debian_password] %>' WITH GRANT OPTION;
<% end -%>
<% if node[:mysql][:remote_root_user] == "enabled" -%>
# Grant root access from any host.
GRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '<%= node[:mysql][:server_root_password] %>' WITH GRANT OPTION;
<% end -%>
<% if node['mysql']['repl_user_status'] == "enabled" -%>
# Grant replication for a slave user.
<% if node['mysql']['repl_user_ssl_status'] == "enabled" -%>
GRANT REPLICATION SLAVE ON *.* TO '<%= node['mysql']['repl_user'] %>'@'%' identified by '<%= node['mysql']['server_repl_password'] %>' REQUIRE ISSUER '<%= node['mysql']['repl_user_ssl_require_issuer'] %>';
<% else -%>
GRANT REPLICATION SLAVE ON *.* TO '<%= node['mysql']['repl_user'] %>'@'%' identified by '<%= node['mysql']['server_repl_password'] %>';
<% end -%>
<% end -%>

# Set the server root password. This should be preseeded by the package installation.
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('<%= node['mysql']['server_root_password'] %>');
